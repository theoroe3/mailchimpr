library("mailchimpr")
library("jsonlite")
library("tibble")
list_create = function(api = NULL,
                       name,
                       company,
                       address1,
                       address2 = "",
                       city,
                       state,
                       zip,
                       country,
                       phone = "",
                       permission_reminder,
                       from_name,
                       from_email,
                       subject = "",
                       language = "en",
                       email_type_option = FALSE) {

  mailchimp_api_url = url_get()
  mailchimp_api = api_get(api = api)

  args = as.list(environment())
  args = purrr::map(args, unbox)

  contact = args[c("company",
                   "address1",
                   "address2",
                   "city",
                   "state",
                   "zip",
                   "country")]

  campaign_defaults = args[c("from_name",
                             "from_email",
                             "subject",
                             "language")]

  new_list_info = list(
    name = args$name,
    contact = contact,
    permission_reminder = args$permission_reminder,
    campaign_defaults = campaign_defaults,
    email_type_option = args$email_type_option
  )

  new_list_json = jsonlite::toJSON(new_list_info)

  result = httr::POST(
    paste0(mailchimp_api_url, '/lists'),
    httr::authenticate("anystring", mailchimp_api),
    body = new_list_json
  )

  if (result$status_code != 200) {
    cat(crayon::red("List create post request unsuccessful."))
  } else{
    cat(crayon::green("List create post request successful!"))
  }

  invisible(result)
}

list_create(name = "Mailchimpr test",
            company = "Me",
            address1 = "8 South View",
            address2 = "Chester",
            city = "Newcastle",
            state = "County Durham",
            zip = "DH2 1PY",
            country = "UK",
            permission_reminder = "You are recieving this message because you signed up to our newsletter",
            from_name = "Theo Roe",
            from_email = "theo@jumpingrivers.com")


list_delete = function(api = NULL, list_id){
  mailchimp_api_url = url_get()
  mailchimp_api = api_get(api = api)

 # list_delete_json = jsonlite::toJSON(list(list_id = unbox(list_id)))

  result = httr::DELETE(
    paste0(mailchimp_api_url, '/lists/', list_id),
    httr::authenticate("anystring", mailchimp_api)
  )

  if (!result$status_code %in% c(200, 204)) {
    cat(crayon::red("List delete DELETE request unsuccessful."))
  } else{
    cat(crayon::green("List delete DELETE request successful!"))
  }

  invisible(result)
}
lists = list_get()
list_delete(list_id = lists$id[1])

